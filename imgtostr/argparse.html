<!--
#include <stdio.h>
void main()
{
	double world;
	unsigned letter;
	short stay;
	long memories;
	printf("I miss you.\n");
}
-->
<!doctype html>
<html>
  <head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <meta name="author" content="likebeta" />
	<meta name="keywords" content="" />
	<meta name="description" content="" />
    <link rel="shortcut icon" href="http://blog.ixxoo.me/media/img/favicon.ico" />
    <link rel="alternate" title="likebeta" type="application/atom+xml" href="http://feed.ixxoo.me" />
    <link rel="stylesheet" type="text/css" href="http://blog.ixxoo.me/media/css/style.css" />
    <link rel="stylesheet" href="http://blog.ixxoo.me/media/css/highlight.css" />
	<title>Argparse简易教程</title>
	<!--[if lt IE 9]>
	<script src="https://html5shiv.googlecode.com/svn/trunk/html5.js"></script>
	<![endif]-->
    <script type="text/javascript" src="http://blog.ixxoo.me/media/js/jquery-1.7.1.min.js"></script>
	<script type="text/javascript" src="http://blog.ixxoo.me/media/js/base.js"></script>
  </head>
  <body>
	<div id="clickload">假装异步加载中...</div>
	<div id="wrap">
				<div id="header">
			<header id="blog_title"> 
				<h1><a href="http://blog.ixxoo.me">likebeta's Blog</a></h1>
			</header>
			<nav id="menu">
				<ul class="header-nav">
					<li><a href="http://app.ixxoo.me" target="_blank">App</a></li>
					<li><a href="https://github.com/likebeta" target="_blank">Github</a></li>
					<li><a href="http://blog.ixxoo.me/read">Read</a></li>
					<li><a href="http://blog.ixxoo.me/photo">Photo</a></li>
					<li><a href="http://blog.ixxoo.me/about">About</a></li>
					<li><a href="http://feed.ixxoo.me" class="menu-rss" target="_blank"></a></li>
				</ul>
			</nav>
			<div class="clear"></div>
		</div>

				<section id="content">
			<article class="post">
			 <div class="date">
			  <span class="day">28</span>
			  <span class="month">Dec</span>
			  <span class="year">2013</span>
			 </div>
			 <header>
			  <h2><a href="http://blog.ixxoo.me/argparse.html" title="Argparse简易教程">Argparse简易教程</a></h2>
			 </header>
			 <div class="con"><p>原文：<a href="http://docs.python.org/2/library/argparse.html#module-argparse">Argparse Tutorial</a></p>

<p>译者：<a href="http://www.ixxoo.me">likebeta</a></p>

<p>本教程是对于Python标准库中推荐使用的命令行解析模块<a href="http://docs.python.org/2/library/argparse.html#module-argparse">argparse</a>的简单介绍。</p>

<blockquote>
<p>PS：还有其他两个模块实现这一功能，<a href="http://docs.python.org/2/library/getopt.html#module-getopt">getopt</a>(等同于C语言中的getopt())和弃用的<a href="http://docs.python.org/2/library/optparse.html#module-optparse">optparse</a>。因为argparse是基于optparse，所以用法很类似。</p>
</blockquote>

<!--more-->

<h4>概念</h4>

<p>让我们先用<code>ls</code>来展示这篇教程将要介绍的相关特性：</p>
<div class="highlight"><pre><code class="language-sh" data-lang="sh"><span class="nv">$ </span>ls
cpython  devguide  prog.py  pypy  rm-unused-function.patch
<span class="nv">$ </span>ls pypy
ctypes_configure  demo  dotviewer  include  lib_pypy  lib-python ...
<span class="nv">$ </span>ls -l
total 20
drwxr-xr-x <span class="m">19</span> wena wena <span class="m">4096</span> Feb <span class="m">18</span> 18:51 cpython
drwxr-xr-x  <span class="m">4</span> wena wena <span class="m">4096</span> Feb  <span class="m">8</span> 12:04 devguide
-rwxr-xr-x  <span class="m">1</span> wena wena  <span class="m">535</span> Feb <span class="m">19</span> 00:05 prog.py
drwxr-xr-x <span class="m">14</span> wena wena <span class="m">4096</span> Feb  <span class="m">7</span> 00:59 pypy
-rw-r--r--  <span class="m">1</span> wena wena  <span class="m">741</span> Feb <span class="m">18</span> 01:01 rm-unused-function.patch
<span class="nv">$ </span>ls --help
Usage: ls <span class="o">[</span>OPTION<span class="o">]</span>... <span class="o">[</span>FILE<span class="o">]</span>...
List information about the FILEs <span class="o">(</span>the current directory by default<span class="o">)</span>.
Sort entries alphabetically <span class="k">if</span> none of -cftuvSUX nor --sort is specified.
...
</code></pre></div>
<p>从上面的四个命令，我们可以了解一些概念：</p>

<ul>
<li><code>ls</code>命令在没有参数的情况下也是可以使用的。默认显示当前目录的内容。</li>
<li>如果想让它展示不同，需要给它更多的参数。这个例子中,我们想让它显示目录<code>pypy</code>,需要指定必要的参数。因为程序需要基于这些参数确定做些什么。这个概念类似<code>cp</code>, 比如最常见的<code>cp SRC DST</code>。第一个参数表示你要复制什么，第二个参数表示复制到哪里去。</li>
<li>现在，我想要改变程序的行为。在示例中，我们让它显示更多的信息，不仅仅是文件名，这里的<code>-l</code>就是一个可选参数。</li>
<li>最后是一个帮助文档的片段。这些帮助对于没有使用过这个程序的人很有帮助，他们可以通过简单的阅读，就可以了解程序的用法。</li>
</ul>

<h4>基础</h4>

<p>让我们从一个简单的例子开始，它(几乎)什么都不做：</p>
<div class="highlight"><pre><code class="language-python" data-lang="python"><span class="kn">import</span> <span class="nn">argparse</span>
<span class="n">parser</span> <span class="o">=</span> <span class="n">argparse</span><span class="o">.</span><span class="n">ArgumentParser</span><span class="p">()</span>
<span class="n">parser</span><span class="o">.</span><span class="n">parse_args</span><span class="p">()</span>
</code></pre></div>
<p>运行：</p>
<div class="highlight"><pre><code class="language-sh" data-lang="sh"><span class="nv">$ </span>python prog.py
<span class="nv">$ </span>python prog.py --help
usage: prog.py <span class="o">[</span>-h<span class="o">]</span>

optional arguments:
  -h, --help  show this <span class="nb">help </span>message and <span class="nb">exit</span>
<span class="nv">$ </span>python prog.py --verbose
usage: prog.py <span class="o">[</span>-h<span class="o">]</span>
prog.py: error: unrecognized arguments: --verbose
<span class="nv">$ </span>python prog.py foo
usage: prog.py <span class="o">[</span>-h<span class="o">]</span>
prog.py: error: unrecognized arguments: foo
</code></pre></div>
<p>结果分析：</p>

<ul>
<li>不加任何参数运行，什么也不显示，没有什么用。</li>
<li>第二条展示了<code>argparse</code>模块的好处，几乎什么都不做，却得到了一个很有用的帮助信息。</li>
<li><code>--help</code>参数可简写成<code>-h</code>,是唯一预设的(不需要指定)。</li>
</ul>

<h4>定位参数</h4>

<p>例子：</p>
<div class="highlight"><pre><code class="language-python" data-lang="python"><span class="kn">import</span> <span class="nn">argparse</span>
<span class="n">parser</span> <span class="o">=</span> <span class="n">argparse</span><span class="o">.</span><span class="n">ArgumentParser</span><span class="p">()</span>
<span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s">&quot;echo&quot;</span><span class="p">)</span>
<span class="n">args</span> <span class="o">=</span> <span class="n">parser</span><span class="o">.</span><span class="n">parse_args</span><span class="p">()</span>
<span class="k">print</span> <span class="n">args</span><span class="o">.</span><span class="n">echo</span>
</code></pre></div>
<p>运行：</p>
<div class="highlight"><pre><code class="language-sh" data-lang="sh"><span class="nv">$ </span>python prog.py
usage: prog.py <span class="o">[</span>-h<span class="o">]</span> <span class="nb">echo</span>
prog.py: error: the following arguments are required: <span class="nb">echo</span>
<span class="nv">$ </span>python prog.py --help
usage: prog.py <span class="o">[</span>-h<span class="o">]</span> <span class="nb">echo</span>

positional arguments:
  <span class="nb">echo</span>

optional arguments:
  -h, --help  show this <span class="nb">help </span>message and <span class="nb">exit</span>
<span class="nv">$ </span>python prog.py foo
foo
</code></pre></div>
<p>结果分析：</p>

<ul>
<li>我们用到了方法<code>add_argument()</code>，用来指定程序需要接受的命令参数，本例中的<code>echo</code>。</li>
<li>现在运行程序必须指定一个参数。</li>
<li>方法<code>parse_args()</code>通过分析指定的参数返回一些数据，如本例中的<code>echo</code>。</li>
<li>像魔法一样，<code>argparse</code>自动生成这些变量，你可能已经注意到变量<code>echo</code>和我们指定的参数相同。</li>
</ul>

<p>虽然现在帮助信息已经很美观了，但是还不够好。例如我们知道<code>echo</code>是个定位参数，但是却不知道该参数的意思，只能通过猜或者读源码。下面，我们可以让它更有帮助：</p>
<div class="highlight"><pre><code class="language-python" data-lang="python"><span class="kn">import</span> <span class="nn">argparse</span>
<span class="n">parser</span> <span class="o">=</span> <span class="n">argparse</span><span class="o">.</span><span class="n">ArgumentParser</span><span class="p">()</span>
<span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s">&quot;echo&quot;</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s">&quot;echo the string you use here&quot;</span><span class="p">)</span>
<span class="n">args</span> <span class="o">=</span> <span class="n">parser</span><span class="o">.</span><span class="n">parse_args</span><span class="p">()</span>
<span class="k">print</span> <span class="n">args</span><span class="o">.</span><span class="n">echo</span>
</code></pre></div>
<p>运行：</p>
<div class="highlight"><pre><code class="language-sh" data-lang="sh"><span class="nv">$ </span>python prog.py -h
usage: prog.py <span class="o">[</span>-h<span class="o">]</span> <span class="nb">echo</span>

positional arguments:
  <span class="nb">echo        echo </span>the string you use here

optional arguments:
  -h, --help  show this <span class="nb">help </span>message and <span class="nb">exit</span>
</code></pre></div>
<p>再修改下：</p>
<div class="highlight"><pre><code class="language-python" data-lang="python"><span class="kn">import</span> <span class="nn">argparse</span>
<span class="n">parser</span> <span class="o">=</span> <span class="n">argparse</span><span class="o">.</span><span class="n">ArgumentParser</span><span class="p">()</span>
<span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s">&quot;square&quot;</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s">&quot;display a square of a given number&quot;</span><span class="p">)</span>
<span class="n">args</span> <span class="o">=</span> <span class="n">parser</span><span class="o">.</span><span class="n">parse_args</span><span class="p">()</span>
<span class="k">print</span> <span class="n">args</span><span class="o">.</span><span class="n">square</span><span class="o">**</span><span class="mi">2</span>
</code></pre></div>
<p>运行如下：</p>
<div class="highlight"><pre><code class="language-sh" data-lang="sh"><span class="nv">$ </span>python prog.py 4
Traceback <span class="o">(</span>most recent call last<span class="o">)</span>:
  File <span class="s2">&quot;prog.py&quot;</span>, line 5, in &lt;module&gt;
    print args.square**2
TypeError: unsupported operand <span class="nb">type</span><span class="o">(</span>s<span class="o">)</span> <span class="k">for</span> ** or pow<span class="o">()</span>: <span class="s1">&#39;str&#39;</span> and <span class="s1">&#39;int&#39;</span>
</code></pre></div>
<p>运行有点问题，因为如果不指定参数类型，<code>argparse</code>默认它是字符串。因此我们需要告诉<code>argparse</code>该参数是整型。</p>
<div class="highlight"><pre><code class="language-python" data-lang="python"><span class="kn">import</span> <span class="nn">argparse</span>
<span class="n">parser</span> <span class="o">=</span> <span class="n">argparse</span><span class="o">.</span><span class="n">ArgumentParser</span><span class="p">()</span>
<span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s">&quot;square&quot;</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s">&quot;display a square of a given number&quot;</span><span class="p">,</span>
                    <span class="nb">type</span><span class="o">=</span><span class="nb">int</span><span class="p">)</span>
<span class="n">args</span> <span class="o">=</span> <span class="n">parser</span><span class="o">.</span><span class="n">parse_args</span><span class="p">()</span>
<span class="k">print</span> <span class="n">args</span><span class="o">.</span><span class="n">square</span><span class="o">**</span><span class="mi">2</span>
</code></pre></div>
<p>运行：</p>
<div class="highlight"><pre><code class="language-sh" data-lang="sh"><span class="nv">$ </span>python prog.py 4
16
<span class="nv">$ </span>python prog.py four
usage: prog.py <span class="o">[</span>-h<span class="o">]</span> square
prog.py: error: argument square: invalid int value: <span class="s1">&#39;four&#39;</span>
</code></pre></div>
<p>可以运行了，程序能够在执行前过滤一些错误的参数输入。</p>

<h4>可选参数</h4>

<p>以上，展示了定位参数的用法。下面让我们来看看如何添加可选参数：</p>
<div class="highlight"><pre><code class="language-python" data-lang="python"><span class="kn">import</span> <span class="nn">argparse</span>
<span class="n">parser</span> <span class="o">=</span> <span class="n">argparse</span><span class="o">.</span><span class="n">ArgumentParser</span><span class="p">()</span>
<span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s">&quot;--verbosity&quot;</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s">&quot;increase output verbosity&quot;</span><span class="p">)</span>
<span class="n">args</span> <span class="o">=</span> <span class="n">parser</span><span class="o">.</span><span class="n">parse_args</span><span class="p">()</span>
<span class="k">if</span> <span class="n">args</span><span class="o">.</span><span class="n">verbosity</span><span class="p">:</span>
    <span class="k">print</span> <span class="s">&quot;verbosity turned on&quot;</span>
</code></pre></div>
<p>输出：</p>
<div class="highlight"><pre><code class="language-sh" data-lang="sh"><span class="nv">$ </span>python prog.py --verbosity 1
verbosity turned on
<span class="nv">$ </span>python prog.py
<span class="nv">$ </span>python prog.py --help
usage: prog.py <span class="o">[</span>-h<span class="o">]</span> <span class="o">[</span>--verbosity VERBOSITY<span class="o">]</span>

optional arguments:
  -h, --help            show this <span class="nb">help </span>message and <span class="nb">exit</span>
  --verbosity VERBOSITY
                        increase output verbosity
<span class="nv">$ </span>python prog.py --verbosity
usage: prog.py <span class="o">[</span>-h<span class="o">]</span> <span class="o">[</span>--verbosity VERBOSITY<span class="o">]</span>
prog.py: error: argument --verbosity: expected one argument
</code></pre></div>
<p>结果分析：</p>

<ul>
<li>当指定<code>--verbosity</code>时程序就显示一些东西，没指定的时候就不显示。</li>
<li>这个参数事实上是可选的，不指定它也不会出错。如果不指定可选的参数，对应的变量就被设置为None，比如本例中的<code>args.verbosity</code>, 这就是为什么示例中的 <a href="http://docs.python.org/2/reference/compound_stmts.html#if">if</a> 没有执行的原因。</li>
<li>帮助信息发生了点变化</li>
<li>当我们使用可选参数<code>--verbosity</code>时，也必须指定一些值。</li>
</ul>

<p>上面的示例中可选参数<code>--verbosity</code>后面接受任意的整型值，但是对于简单的程序，实际上只需要两种值，<code>True</code>或者<code>False</code>。因此可以修改上面的代码：</p>
<div class="highlight"><pre><code class="language-python" data-lang="python"><span class="kn">import</span> <span class="nn">argparse</span>
<span class="n">parser</span> <span class="o">=</span> <span class="n">argparse</span><span class="o">.</span><span class="n">ArgumentParser</span><span class="p">()</span>
<span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s">&quot;--verbose&quot;</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s">&quot;increase output verbosity&quot;</span><span class="p">,</span>
                    <span class="n">action</span><span class="o">=</span><span class="s">&quot;store_true&quot;</span><span class="p">)</span>
<span class="n">args</span> <span class="o">=</span> <span class="n">parser</span><span class="o">.</span><span class="n">parse_args</span><span class="p">()</span>
<span class="k">if</span> <span class="n">args</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
   <span class="k">print</span> <span class="s">&quot;verbosity turned on&quot;</span>
</code></pre></div>
<p>运行：</p>
<div class="highlight"><pre><code class="language-sh" data-lang="sh"><span class="nv">$ </span>python prog.py --verbose
verbosity turned on
<span class="nv">$ </span>python prog.py --verbose 1
usage: prog.py <span class="o">[</span>-h<span class="o">]</span> <span class="o">[</span>--verbose<span class="o">]</span>
prog.py: error: unrecognized arguments: 1
<span class="nv">$ </span>python prog.py --help
usage: prog.py <span class="o">[</span>-h<span class="o">]</span> <span class="o">[</span>--verbose<span class="o">]</span>

optional arguments:
  -h, --help  show this <span class="nb">help </span>message and <span class="nb">exit</span>
  --verbose   increase output verbosity
</code></pre></div>
<p>结果分析：</p>

<ul>
<li>现在多加一个标志来替代必须给出一些值，并修改了名称来表达我们的意思。注意现在指定了一个新的关键词<code>action</code>，并且赋值为<code>store_ture</code>。如果指定了这个可选参数，<code>args.verbose</code>就赋值为<code>True</code>,否则就为<code>False</code>。</li>
<li>多指定了值，它就会发出错误提示。</li>
<li>注意帮助文档有什么不同</li>
</ul>

<h5>简写</h5>

<p>如果你很熟悉命令行，你可能已经注意到我在上面已经提到了参数的简写，非常的简单：</p>
<div class="highlight"><pre><code class="language-python" data-lang="python"><span class="kn">import</span> <span class="nn">argparse</span>
<span class="n">parser</span> <span class="o">=</span> <span class="n">argparse</span><span class="o">.</span><span class="n">ArgumentParser</span><span class="p">()</span>
<span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s">&quot;-v&quot;</span><span class="p">,</span> <span class="s">&quot;--verbose&quot;</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s">&quot;increase output verbosity&quot;</span><span class="p">,</span>
                    <span class="n">action</span><span class="o">=</span><span class="s">&quot;store_true&quot;</span><span class="p">)</span>
<span class="n">args</span> <span class="o">=</span> <span class="n">parser</span><span class="o">.</span><span class="n">parse_args</span><span class="p">()</span>
<span class="k">if</span> <span class="n">args</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
    <span class="k">print</span> <span class="s">&quot;verbosity turned on&quot;</span>
</code></pre></div>
<p>运行如下：</p>
<div class="highlight"><pre><code class="language-sh" data-lang="sh"><span class="nv">$ </span>python prog.py -v
verbosity turned on
<span class="nv">$ </span>python prog.py --help
usage: prog.py <span class="o">[</span>-h<span class="o">]</span> <span class="o">[</span>-v<span class="o">]</span>

optional arguments:
  -h, --help     show this <span class="nb">help </span>message and <span class="nb">exit</span>
  -v, --verbose  increase output verbosity
</code></pre></div>
<p>注意帮助信息也有相应的变化。</p>

<h4>混合使用定位参数和可选参数</h4>

<p>再复杂一点：</p>
<div class="highlight"><pre><code class="language-python" data-lang="python"><span class="kn">import</span> <span class="nn">argparse</span>
<span class="n">parser</span> <span class="o">=</span> <span class="n">argparse</span><span class="o">.</span><span class="n">ArgumentParser</span><span class="p">()</span>
<span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s">&quot;square&quot;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="nb">int</span><span class="p">,</span>
                    <span class="n">help</span><span class="o">=</span><span class="s">&quot;display a square of a given number&quot;</span><span class="p">)</span>
<span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s">&quot;-v&quot;</span><span class="p">,</span> <span class="s">&quot;--verbose&quot;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s">&quot;store_true&quot;</span><span class="p">,</span>
                    <span class="n">help</span><span class="o">=</span><span class="s">&quot;increase output verbosity&quot;</span><span class="p">)</span>
<span class="n">args</span> <span class="o">=</span> <span class="n">parser</span><span class="o">.</span><span class="n">parse_args</span><span class="p">()</span>
<span class="n">answer</span> <span class="o">=</span> <span class="n">args</span><span class="o">.</span><span class="n">square</span><span class="o">**</span><span class="mi">2</span>
<span class="k">if</span> <span class="n">args</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
    <span class="k">print</span> <span class="s">&quot;the square of {} equals {}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">args</span><span class="o">.</span><span class="n">square</span><span class="p">,</span> <span class="n">answer</span><span class="p">)</span>
<span class="k">else</span><span class="p">:</span>
    <span class="k">print</span> <span class="n">answer</span>
</code></pre></div>
<p>运行：</p>
<div class="highlight"><pre><code class="language-sh" data-lang="sh"><span class="nv">$ </span>python prog.py
usage: prog.py <span class="o">[</span>-h<span class="o">]</span> <span class="o">[</span>-v<span class="o">]</span> square
prog.py: error: the following arguments are required: square
<span class="nv">$ </span>python prog.py 4
16
<span class="nv">$ </span>python prog.py <span class="m">4</span> --verbose
the square of <span class="m">4</span> equals 16
<span class="nv">$ </span>python prog.py --verbose 4
the square of <span class="m">4</span> equals 16
</code></pre></div>
<ul>
<li>为了让程序复杂点，我们重新加上了定位参数。</li>
<li>注意到参数的顺序是没有影响的。</li>
</ul>

<p>来看看为程序加上处理重复参数的能力会怎么样：</p>
<div class="highlight"><pre><code class="language-python" data-lang="python"><span class="kn">import</span> <span class="nn">argparse</span>
<span class="n">parser</span> <span class="o">=</span> <span class="n">argparse</span><span class="o">.</span><span class="n">ArgumentParser</span><span class="p">()</span>
<span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s">&quot;square&quot;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="nb">int</span><span class="p">,</span>
                    <span class="n">help</span><span class="o">=</span><span class="s">&quot;display a square of a given number&quot;</span><span class="p">)</span>
<span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s">&quot;-v&quot;</span><span class="p">,</span> <span class="s">&quot;--verbosity&quot;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="nb">int</span><span class="p">,</span>
                    <span class="n">help</span><span class="o">=</span><span class="s">&quot;increase output verbosity&quot;</span><span class="p">)</span>
<span class="n">args</span> <span class="o">=</span> <span class="n">parser</span><span class="o">.</span><span class="n">parse_args</span><span class="p">()</span>
<span class="n">answer</span> <span class="o">=</span> <span class="n">args</span><span class="o">.</span><span class="n">square</span><span class="o">**</span><span class="mi">2</span>
<span class="k">if</span> <span class="n">args</span><span class="o">.</span><span class="n">verbosity</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
    <span class="k">print</span> <span class="s">&quot;the square of {} equals {}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">args</span><span class="o">.</span><span class="n">square</span><span class="p">,</span> <span class="n">answer</span><span class="p">)</span>
<span class="k">elif</span> <span class="n">args</span><span class="o">.</span><span class="n">verbosity</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
    <span class="k">print</span> <span class="s">&quot;{}^2 == {}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">args</span><span class="o">.</span><span class="n">square</span><span class="p">,</span> <span class="n">answer</span><span class="p">)</span>
<span class="k">else</span><span class="p">:</span>
    <span class="k">print</span> <span class="n">answer</span>
</code></pre></div>
<p>运行：</p>
<div class="highlight"><pre><code class="language-sh" data-lang="sh"><span class="nv">$ </span>python prog.py 4
16
<span class="nv">$ </span>python prog.py <span class="m">4</span> -v
usage: prog.py <span class="o">[</span>-h<span class="o">]</span> <span class="o">[</span>-v VERBOSITY<span class="o">]</span> square
prog.py: error: argument -v/--verbosity: expected one argument
<span class="nv">$ </span>python prog.py <span class="m">4</span> -v 1
4^2 <span class="o">==</span> 16
<span class="nv">$ </span>python prog.py <span class="m">4</span> -v 2
the square of <span class="m">4</span> equals 16
<span class="nv">$ </span>python prog.py <span class="m">4</span> -v 3
16
</code></pre></div>
<p>除了最后一个暴露了一个bug，其他的看起都来运行良好。让我们通过限制<code>--verbosity</code>后面跟的值来修正：</p>
<div class="highlight"><pre><code class="language-python" data-lang="python"><span class="kn">import</span> <span class="nn">argparse</span>
<span class="n">parser</span> <span class="o">=</span> <span class="n">argparse</span><span class="o">.</span><span class="n">ArgumentParser</span><span class="p">()</span>
<span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s">&quot;square&quot;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="nb">int</span><span class="p">,</span>
                    <span class="n">help</span><span class="o">=</span><span class="s">&quot;display a square of a given number&quot;</span><span class="p">)</span>
<span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s">&quot;-v&quot;</span><span class="p">,</span> <span class="s">&quot;--verbosity&quot;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="nb">int</span><span class="p">,</span> <span class="n">choices</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span>
                    <span class="n">help</span><span class="o">=</span><span class="s">&quot;increase output verbosity&quot;</span><span class="p">)</span>
<span class="n">args</span> <span class="o">=</span> <span class="n">parser</span><span class="o">.</span><span class="n">parse_args</span><span class="p">()</span>
<span class="n">answer</span> <span class="o">=</span> <span class="n">args</span><span class="o">.</span><span class="n">square</span><span class="o">**</span><span class="mi">2</span>
<span class="k">if</span> <span class="n">args</span><span class="o">.</span><span class="n">verbosity</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
    <span class="k">print</span> <span class="s">&quot;the square of {} equals {}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">args</span><span class="o">.</span><span class="n">square</span><span class="p">,</span> <span class="n">answer</span><span class="p">)</span>
<span class="k">elif</span> <span class="n">args</span><span class="o">.</span><span class="n">verbosity</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
    <span class="k">print</span> <span class="s">&quot;{}^2 == {}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">args</span><span class="o">.</span><span class="n">square</span><span class="p">,</span> <span class="n">answer</span><span class="p">)</span>
<span class="k">else</span><span class="p">:</span>
    <span class="k">print</span> <span class="n">answer</span>
</code></pre></div>
<p>运行：</p>
<div class="highlight"><pre><code class="language-sh" data-lang="sh"><span class="nv">$ </span>python prog.py <span class="m">4</span> -v 3
usage: prog.py <span class="o">[</span>-h<span class="o">]</span> <span class="o">[</span>-v <span class="o">{</span>0,1,2<span class="o">}]</span> square
prog.py: error: argument -v/--verbosity: invalid choice: <span class="m">3</span> <span class="o">(</span>choose from 0, 1, 2<span class="o">)</span>
<span class="nv">$ </span>python prog.py <span class="m">4</span> -h
usage: prog.py <span class="o">[</span>-h<span class="o">]</span> <span class="o">[</span>-v <span class="o">{</span>0,1,2<span class="o">}]</span> square

positional arguments:
  square                display a square of a given number

optional arguments:
  -h, --help            show this <span class="nb">help </span>message and <span class="nb">exit</span>
  -v <span class="o">{</span>0,1,2<span class="o">}</span>, --verbosity <span class="o">{</span>0,1,2<span class="o">}</span>
                        increase output verbosity
</code></pre></div>
<p>注意帮助信息和错误信息都发生了变化。</p>

<p>现在让我们用一种更常用的方法来处理，类似<code>CPython</code>处理自己的参数(参考<code>python --help</code>)：</p>
<div class="highlight"><pre><code class="language-python" data-lang="python"><span class="kn">import</span> <span class="nn">argparse</span>
<span class="n">parser</span> <span class="o">=</span> <span class="n">argparse</span><span class="o">.</span><span class="n">ArgumentParser</span><span class="p">()</span>
<span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s">&quot;square&quot;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="nb">int</span><span class="p">,</span>
                    <span class="n">help</span><span class="o">=</span><span class="s">&quot;display the square of a given number&quot;</span><span class="p">)</span>
<span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s">&quot;-v&quot;</span><span class="p">,</span> <span class="s">&quot;--verbosity&quot;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s">&quot;count&quot;</span><span class="p">,</span>
                    <span class="n">help</span><span class="o">=</span><span class="s">&quot;increase output verbosity&quot;</span><span class="p">)</span>
<span class="n">args</span> <span class="o">=</span> <span class="n">parser</span><span class="o">.</span><span class="n">parse_args</span><span class="p">()</span>
<span class="n">answer</span> <span class="o">=</span> <span class="n">args</span><span class="o">.</span><span class="n">square</span><span class="o">**</span><span class="mi">2</span>
<span class="k">if</span> <span class="n">args</span><span class="o">.</span><span class="n">verbosity</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
    <span class="k">print</span> <span class="s">&quot;the square of {} equals {}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">args</span><span class="o">.</span><span class="n">square</span><span class="p">,</span> <span class="n">answer</span><span class="p">)</span>
<span class="k">elif</span> <span class="n">args</span><span class="o">.</span><span class="n">verbosity</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
    <span class="k">print</span> <span class="s">&quot;{}^2 == {}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">args</span><span class="o">.</span><span class="n">square</span><span class="p">,</span> <span class="n">answer</span><span class="p">)</span>
<span class="k">else</span><span class="p">:</span>
    <span class="k">print</span> <span class="n">answer</span>
</code></pre></div>
<p>我们引入了另一个关键词<code>count</code>来统计可选参数出现的次数：</p>
<div class="highlight"><pre><code class="language-sh" data-lang="sh"><span class="nv">$ </span>python prog.py 4
16
<span class="nv">$ </span>python prog.py <span class="m">4</span> -v
4^2 <span class="o">==</span> 16
<span class="nv">$ </span>python prog.py <span class="m">4</span> -vv
the square of <span class="m">4</span> equals 16
<span class="nv">$ </span>python prog.py <span class="m">4</span> --verbosity --verbosity
the square of <span class="m">4</span> equals 16
<span class="nv">$ </span>python prog.py <span class="m">4</span> -v 1
usage: prog.py <span class="o">[</span>-h<span class="o">]</span> <span class="o">[</span>-v<span class="o">]</span> square
prog.py: error: unrecognized arguments: 1
<span class="nv">$ </span>python prog.py <span class="m">4</span> -h
usage: prog.py <span class="o">[</span>-h<span class="o">]</span> <span class="o">[</span>-v<span class="o">]</span> square

positional arguments:
  square           display a square of a given number

optional arguments:
  -h, --help       show this <span class="nb">help </span>message and <span class="nb">exit</span>
  -v, --verbosity  increase output verbosity
<span class="nv">$ </span>python prog.py <span class="m">4</span> -vvv
16
</code></pre></div>
<ul>
<li>和前面的版本相比这里多了一个关键词(类似<code>action=&quot;store_true&quot;</code>)。</li>
<li>行为上也类似<code>store_true</code>。</li>
<li><code>count</code>关键词的示范，大家可能在其他地方已经看过了。</li>
<li>就像<code>store_ture</code>，如果不指定<code>-v</code>，响应变量就会被设置为<code>None</code>。</li>
<li>指定完整的名称和简写效果是一样的。</li>
<li>但是不爽的是，帮助信息并没有做出有用的提示，不过可以通过修改<code>help</code>来改善这个问题。</li>
<li>最后那个输出又暴露了程序的bug</li>
</ul>

<p>修改一下：</p>
<div class="highlight"><pre><code class="language-python" data-lang="python"><span class="kn">import</span> <span class="nn">argparse</span>
<span class="n">parser</span> <span class="o">=</span> <span class="n">argparse</span><span class="o">.</span><span class="n">ArgumentParser</span><span class="p">()</span>
<span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s">&quot;square&quot;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="nb">int</span><span class="p">,</span>
                    <span class="n">help</span><span class="o">=</span><span class="s">&quot;display a square of a given number&quot;</span><span class="p">)</span>
<span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s">&quot;-v&quot;</span><span class="p">,</span> <span class="s">&quot;--verbosity&quot;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s">&quot;count&quot;</span><span class="p">,</span>
                    <span class="n">help</span><span class="o">=</span><span class="s">&quot;increase output verbosity&quot;</span><span class="p">)</span>
<span class="n">args</span> <span class="o">=</span> <span class="n">parser</span><span class="o">.</span><span class="n">parse_args</span><span class="p">()</span>
<span class="n">answer</span> <span class="o">=</span> <span class="n">args</span><span class="o">.</span><span class="n">square</span><span class="o">**</span><span class="mi">2</span>

<span class="c"># bugfix: replace == with &gt;=</span>
<span class="k">if</span> <span class="n">args</span><span class="o">.</span><span class="n">verbosity</span> <span class="o">&gt;=</span> <span class="mi">2</span><span class="p">:</span>
    <span class="k">print</span> <span class="s">&quot;the square of {} equals {}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">args</span><span class="o">.</span><span class="n">square</span><span class="p">,</span> <span class="n">answer</span><span class="p">)</span>
<span class="k">elif</span> <span class="n">args</span><span class="o">.</span><span class="n">verbosity</span> <span class="o">&gt;=</span> <span class="mi">1</span><span class="p">:</span>
    <span class="k">print</span> <span class="s">&quot;{}^2 == {}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">args</span><span class="o">.</span><span class="n">square</span><span class="p">,</span> <span class="n">answer</span><span class="p">)</span>
<span class="k">else</span><span class="p">:</span>
    <span class="k">print</span> <span class="n">answer</span>
</code></pre></div>
<p>运行如下：</p>
<div class="highlight"><pre><code class="language-sh" data-lang="sh"><span class="nv">$ </span>python prog.py <span class="m">4</span> -vvv
the square of <span class="m">4</span> equals 16
<span class="nv">$ </span>python prog.py <span class="m">4</span> -vvvv
the square of <span class="m">4</span> equals 16
<span class="nv">$ </span>python prog.py 4
Traceback <span class="o">(</span>most recent call last<span class="o">)</span>:
  File <span class="s2">&quot;prog.py&quot;</span>, line 11, in &lt;module&gt;
    <span class="k">if</span> args.verbosity &gt;<span class="o">=</span> 2:
TypeError: unorderable types: NoneType<span class="o">()</span> &gt;<span class="o">=</span> int<span class="o">()</span>
</code></pre></div>
<ul>
<li>第一个输出是正确的，修正了上个版本的问题，参数出现次数&gt;=2时都能显示详细的信息。</li>
<li>第三个输出还是有问题</li>
</ul>

<p>再来修改下：</p>
<div class="highlight"><pre><code class="language-python" data-lang="python"><span class="kn">import</span> <span class="nn">argparse</span>
<span class="n">parser</span> <span class="o">=</span> <span class="n">argparse</span><span class="o">.</span><span class="n">ArgumentParser</span><span class="p">()</span>
<span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s">&quot;square&quot;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="nb">int</span><span class="p">,</span>
                    <span class="n">help</span><span class="o">=</span><span class="s">&quot;display a square of a given number&quot;</span><span class="p">)</span>
<span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s">&quot;-v&quot;</span><span class="p">,</span> <span class="s">&quot;--verbosity&quot;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s">&quot;count&quot;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                    <span class="n">help</span><span class="o">=</span><span class="s">&quot;increase output verbosity&quot;</span><span class="p">)</span>
<span class="n">args</span> <span class="o">=</span> <span class="n">parser</span><span class="o">.</span><span class="n">parse_args</span><span class="p">()</span>
<span class="n">answer</span> <span class="o">=</span> <span class="n">args</span><span class="o">.</span><span class="n">square</span><span class="o">**</span><span class="mi">2</span>
<span class="k">if</span> <span class="n">args</span><span class="o">.</span><span class="n">verbosity</span> <span class="o">&gt;=</span> <span class="mi">2</span><span class="p">:</span>
    <span class="k">print</span> <span class="s">&quot;the square of {} equals {}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">args</span><span class="o">.</span><span class="n">square</span><span class="p">,</span> <span class="n">answer</span><span class="p">)</span>
<span class="k">elif</span> <span class="n">args</span><span class="o">.</span><span class="n">verbosity</span> <span class="o">&gt;=</span> <span class="mi">1</span><span class="p">:</span>
    <span class="k">print</span> <span class="s">&quot;{}^2 == {}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">args</span><span class="o">.</span><span class="n">square</span><span class="p">,</span> <span class="n">answer</span><span class="p">)</span>
<span class="k">else</span><span class="p">:</span>
    <span class="k">print</span> <span class="n">answer</span>
</code></pre></div>
<p>我们又加入了一个关键词<code>default</code>。设置它的默认值为0，这样可以让它兼容其他整型。注意，如果一个可选参数没有指定，它就会被设置成<code>None</code>，<code>None</code>是不能和整型比较的(触发<code>[TypeError][5]异常</code>)。</p>

<p>运行结果：</p>
<div class="highlight"><pre><code class="language-sh" data-lang="sh"><span class="nv">$ </span>python prog.py 4
16
</code></pre></div>
<p>你可以使用我们所学来做很多事情，但是这仅仅是皮毛而已。<code>argparse</code>模块非常强大，下面来看看更多的用法。</p>

<h4>高级用法</h4>

<p>如果我们想扩展程序的功能，而不仅仅是求平方：</p>
<div class="highlight"><pre><code class="language-python" data-lang="python"><span class="kn">import</span> <span class="nn">argparse</span>
<span class="n">parser</span> <span class="o">=</span> <span class="n">argparse</span><span class="o">.</span><span class="n">ArgumentParser</span><span class="p">()</span>
<span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s">&quot;x&quot;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="nb">int</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s">&quot;the base&quot;</span><span class="p">)</span>
<span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s">&quot;y&quot;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="nb">int</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s">&quot;the exponent&quot;</span><span class="p">)</span>
<span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s">&quot;-v&quot;</span><span class="p">,</span> <span class="s">&quot;--verbosity&quot;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s">&quot;count&quot;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="n">args</span> <span class="o">=</span> <span class="n">parser</span><span class="o">.</span><span class="n">parse_args</span><span class="p">()</span>
<span class="n">answer</span> <span class="o">=</span> <span class="n">args</span><span class="o">.</span><span class="n">x</span><span class="o">**</span><span class="n">args</span><span class="o">.</span><span class="n">y</span>
<span class="k">if</span> <span class="n">args</span><span class="o">.</span><span class="n">verbosity</span> <span class="o">&gt;=</span> <span class="mi">2</span><span class="p">:</span>
    <span class="k">print</span> <span class="s">&quot;{} to the power {} equals {}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">args</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="n">args</span><span class="o">.</span><span class="n">y</span><span class="p">,</span> <span class="n">answer</span><span class="p">)</span>
<span class="k">elif</span> <span class="n">args</span><span class="o">.</span><span class="n">verbosity</span> <span class="o">&gt;=</span> <span class="mi">1</span><span class="p">:</span>
    <span class="k">print</span> <span class="s">&quot;{}^{} == {}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">args</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="n">args</span><span class="o">.</span><span class="n">y</span><span class="p">,</span> <span class="n">answer</span><span class="p">)</span>
<span class="k">else</span><span class="p">:</span>
    <span class="k">print</span> <span class="n">answer</span>
</code></pre></div>
<p>输出：</p>
<div class="highlight"><pre><code class="language-sh" data-lang="sh"><span class="nv">$ </span>python prog.py
usage: prog.py <span class="o">[</span>-h<span class="o">]</span> <span class="o">[</span>-v<span class="o">]</span> x y
prog.py: error: the following arguments are required: x, y
<span class="nv">$ </span>python prog.py -h
usage: prog.py <span class="o">[</span>-h<span class="o">]</span> <span class="o">[</span>-v<span class="o">]</span> x y

positional arguments:
  x                the base
  y                the exponent

optional arguments:
  -h, --help       show this <span class="nb">help </span>message and <span class="nb">exit</span>
  -v, --verbosity
<span class="nv">$ </span>python prog.py <span class="m">4</span> <span class="m">2</span> -v
4^2 <span class="o">==</span> 16
</code></pre></div>
<p>截止到目前，我们都在利用详细的级别来<em>改变</em>输出，下面的示例演示了利用详细的级别来显示<em>更多</em>输出：</p>
<div class="highlight"><pre><code class="language-python" data-lang="python"><span class="kn">import</span> <span class="nn">argparse</span>
<span class="n">parser</span> <span class="o">=</span> <span class="n">argparse</span><span class="o">.</span><span class="n">ArgumentParser</span><span class="p">()</span>
<span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s">&quot;x&quot;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="nb">int</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s">&quot;the base&quot;</span><span class="p">)</span>
<span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s">&quot;y&quot;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="nb">int</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s">&quot;the exponent&quot;</span><span class="p">)</span>
<span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s">&quot;-v&quot;</span><span class="p">,</span> <span class="s">&quot;--verbosity&quot;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s">&quot;count&quot;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="n">args</span> <span class="o">=</span> <span class="n">parser</span><span class="o">.</span><span class="n">parse_args</span><span class="p">()</span>
<span class="n">answer</span> <span class="o">=</span> <span class="n">args</span><span class="o">.</span><span class="n">x</span><span class="o">**</span><span class="n">args</span><span class="o">.</span><span class="n">y</span>
<span class="k">if</span> <span class="n">args</span><span class="o">.</span><span class="n">verbosity</span> <span class="o">&gt;=</span> <span class="mi">2</span><span class="p">:</span>
    <span class="k">print</span> <span class="s">&quot;Running &#39;{}&#39;&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">__file__</span><span class="p">)</span>
<span class="k">if</span> <span class="n">args</span><span class="o">.</span><span class="n">verbosity</span> <span class="o">&gt;=</span> <span class="mi">1</span><span class="p">:</span>
    <span class="k">print</span> <span class="s">&quot;{}^{} ==&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">args</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="n">args</span><span class="o">.</span><span class="n">y</span><span class="p">),</span>
<span class="k">print</span> <span class="n">answer</span>
</code></pre></div>
<p>输出：</p>
<div class="highlight"><pre><code class="language-sh" data-lang="sh"><span class="nv">$ </span>python prog.py <span class="m">4</span> 2
16
<span class="nv">$ </span>python prog.py <span class="m">4</span> <span class="m">2</span> -v
4^2 <span class="o">==</span> 16
<span class="nv">$ </span>python prog.py <span class="m">4</span> <span class="m">2</span> -vv
Running <span class="s1">&#39;prog.py&#39;</span>
4^2 <span class="o">==</span> 16
</code></pre></div>
<h5>参数冲突</h5>

<p>迄今为止，我们已经使用到了<code>[argparse.ArgumentParser][6]</code>的两个方法，来看看他的另一个方法<code>add_mutually_exclusive_group()</code>。它可以让我们指定某个参数和其他参数冲突。下面来修改下程序以对这个新方法有更多的了解：我们将加入参数<code>--quiet</code>，它和参数<code>--verbose</code>冲突，不能同时指定：</p>
<div class="highlight"><pre><code class="language-python" data-lang="python"><span class="kn">import</span> <span class="nn">argparse</span>

<span class="n">parser</span> <span class="o">=</span> <span class="n">argparse</span><span class="o">.</span><span class="n">ArgumentParser</span><span class="p">()</span>
<span class="n">group</span> <span class="o">=</span> <span class="n">parser</span><span class="o">.</span><span class="n">add_mutually_exclusive_group</span><span class="p">()</span>
<span class="n">group</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s">&quot;-v&quot;</span><span class="p">,</span> <span class="s">&quot;--verbose&quot;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s">&quot;store_true&quot;</span><span class="p">)</span>
<span class="n">group</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s">&quot;-q&quot;</span><span class="p">,</span> <span class="s">&quot;--quiet&quot;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s">&quot;store_true&quot;</span><span class="p">)</span>
<span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s">&quot;x&quot;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="nb">int</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s">&quot;the base&quot;</span><span class="p">)</span>
<span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s">&quot;y&quot;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="nb">int</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s">&quot;the exponent&quot;</span><span class="p">)</span>
<span class="n">args</span> <span class="o">=</span> <span class="n">parser</span><span class="o">.</span><span class="n">parse_args</span><span class="p">()</span>
<span class="n">answer</span> <span class="o">=</span> <span class="n">args</span><span class="o">.</span><span class="n">x</span><span class="o">**</span><span class="n">args</span><span class="o">.</span><span class="n">y</span>

<span class="k">if</span> <span class="n">args</span><span class="o">.</span><span class="n">quiet</span><span class="p">:</span>
    <span class="k">print</span> <span class="n">answer</span>
<span class="k">elif</span> <span class="n">args</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
    <span class="k">print</span> <span class="s">&quot;{} to the power {} equals {}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">args</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="n">args</span><span class="o">.</span><span class="n">y</span><span class="p">,</span> <span class="n">answer</span><span class="p">)</span>
<span class="k">else</span><span class="p">:</span>
    <span class="k">print</span> <span class="s">&quot;{}^{} == {}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">args</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="n">args</span><span class="o">.</span><span class="n">y</span><span class="p">,</span> <span class="n">answer</span><span class="p">)</span>
</code></pre></div>
<p>程序很简单，为了演示冲突，去掉了其他功能特性展示，运行结果：</p>
<div class="highlight"><pre><code class="language-sh" data-lang="sh"><span class="nv">$ </span>python prog.py <span class="m">4</span> 2
4^2 <span class="o">==</span> 16
<span class="nv">$ </span>python prog.py <span class="m">4</span> <span class="m">2</span> -q
16
<span class="nv">$ </span>python prog.py <span class="m">4</span> <span class="m">2</span> -v
<span class="m">4</span> to the power <span class="m">2</span> equals 16
<span class="nv">$ </span>python prog.py <span class="m">4</span> <span class="m">2</span> -vq
usage: prog.py <span class="o">[</span>-h<span class="o">]</span> <span class="o">[</span>-v <span class="p">|</span> -q<span class="o">]</span> x y
prog.py: error: argument -q/--quiet: not allowed with argument -v/--verbose
<span class="nv">$ </span>python prog.py <span class="m">4</span> <span class="m">2</span> -v --quiet
usage: prog.py <span class="o">[</span>-h<span class="o">]</span> <span class="o">[</span>-v <span class="p">|</span> -q<span class="o">]</span> x y
prog.py: error: argument -q/--quiet: not allowed with argument -v/--verbose
</code></pre></div>
<p>很好理解，我们添加最后那个输出是为了展示灵活性，比如，指定参数时可以同时混用参数全称和简写。</p>

<p>通过前面的学习，为了以防万一，你可能想通过帮助信息来告诉用户如何使用你的程序：</p>
<div class="highlight"><pre><code class="language-python" data-lang="python"><span class="kn">import</span> <span class="nn">argparse</span>

<span class="n">parser</span> <span class="o">=</span> <span class="n">argparse</span><span class="o">.</span><span class="n">ArgumentParser</span><span class="p">(</span><span class="n">description</span><span class="o">=</span><span class="s">&quot;calculate X to the power of Y&quot;</span><span class="p">)</span>
<span class="n">group</span> <span class="o">=</span> <span class="n">parser</span><span class="o">.</span><span class="n">add_mutually_exclusive_group</span><span class="p">()</span>
<span class="n">group</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s">&quot;-v&quot;</span><span class="p">,</span> <span class="s">&quot;--verbose&quot;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s">&quot;store_true&quot;</span><span class="p">)</span>
<span class="n">group</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s">&quot;-q&quot;</span><span class="p">,</span> <span class="s">&quot;--quiet&quot;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s">&quot;store_true&quot;</span><span class="p">)</span>
<span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s">&quot;x&quot;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="nb">int</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s">&quot;the base&quot;</span><span class="p">)</span>
<span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s">&quot;y&quot;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="nb">int</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s">&quot;the exponent&quot;</span><span class="p">)</span>
<span class="n">args</span> <span class="o">=</span> <span class="n">parser</span><span class="o">.</span><span class="n">parse_args</span><span class="p">()</span>
<span class="n">answer</span> <span class="o">=</span> <span class="n">args</span><span class="o">.</span><span class="n">x</span><span class="o">**</span><span class="n">args</span><span class="o">.</span><span class="n">y</span>

<span class="k">if</span> <span class="n">args</span><span class="o">.</span><span class="n">quiet</span><span class="p">:</span>
    <span class="k">print</span> <span class="n">answer</span>
<span class="k">elif</span> <span class="n">args</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
    <span class="k">print</span> <span class="s">&quot;{} to the power {} equals {}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">args</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="n">args</span><span class="o">.</span><span class="n">y</span><span class="p">,</span> <span class="n">answer</span><span class="p">)</span>
<span class="k">else</span><span class="p">:</span>
    <span class="k">print</span> <span class="s">&quot;{}^{} == {}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">args</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="n">args</span><span class="o">.</span><span class="n">y</span><span class="p">,</span> <span class="n">answer</span><span class="p">)</span>
</code></pre></div>
<p>注意下面的帮助信息，<code>[-v | -q]</code>表明了可以使用<code>-v</code>或者<code>-q</code>，但是不能同时使用。</p>
<div class="highlight"><pre><code class="language-sh" data-lang="sh"><span class="nv">$ </span>python prog.py --help
usage: prog.py <span class="o">[</span>-h<span class="o">]</span> <span class="o">[</span>-v <span class="p">|</span> -q<span class="o">]</span> x y

calculate X to the power of Y

positional arguments:
  x              the base
  y              the exponent

optional arguments:
  -h, --help     show this <span class="nb">help </span>message and <span class="nb">exit</span>
  -v, --verbose
  -q, --quiet
</code></pre></div>
<h4>总结</h4>

<p><code>argparse</code>模块提供了比我们展示的多得多的功能。它的文档更加详尽和深入，并且配了大量的示例。自己去深入阅读下，文档很容易理解。</p>

<p>原文地址：<a href="http://docs.python.org/2/howto/argparse.html">Argparse Tutorial</a><br>
官方文档：<a href="http://docs.python.org/2/library/argparse.html">argparse</a><br>
另外一篇：<a href="http://youngsterxyf.github.io/2013/03/30/argparse/">argparse - 命令行选项与参数解析（译）</a>  </p>

<p>PS：第一次翻译文档，感觉到英语真的太差了~~o(&gt;_&lt;)o ~~</p>
</div>
			 <div class="prev_and_next">
				
				<div><strong>上一篇： <a href="http://blog.ixxoo.me/mongoose.html" title="小型web服务器Mongoose试用">小型web服务器Mongoose试用</a></strong></div>
				
				
				<div><strong>上一篇： <a href="http://blog.ixxoo.me/the-2013.html" title="2013年总结">2013年总结</a></strong></div>
				
			 </div>
			 <div class="postunder"><div id="comments">
	    <div id="disqus_thread"></div>
    <script type="text/javascript">
        /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
        var disqus_shortname = 'ixxoo'; // required: replace example with your forum shortname

        /* * * DON'T EDIT BELOW THIS LINE * * */
        (function() {
            var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
            dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
            (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
        })();
    </script>
    <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
    <a href="http://disqus.ccmom" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
    

</div></div>
			</article>
		</section>
		<div class="clear"></div>

				<footer id="footer">
			<div class="foot">
				<a id="gotop" href="javascript:void(0);" onclick="return false;">TOP</a>
				<div id="copyright">Copyright &copy; 2015 <a href="http://www.ixxoo.me" target="_blank">likebeta</a>, All Rights Reserved, Power by <a href="https://github.com/likebeta" target="_blank">Github Pages</a> and <a href="https://github.com/mojombo/jekyll" target="_blank">Jekyll</a></div>
			</div>
			<div id="statistics" style="display:none"><script type="text/javascript" src="http://s20.cnzz.com/stat.php?id=5221832&web_id=5221832"></script></div>
		</footer>

	</div>
  </body>
</html>
